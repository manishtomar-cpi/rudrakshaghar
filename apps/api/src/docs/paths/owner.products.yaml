paths:
  /api/v1/owner/products:
    post:
      tags: [Owner]
      summary: Create a new product
      description: >
        Creates a new product in the catalog. Only accessible by the OWNER user.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OwnerCreateProductRequest"
      responses:
        "201":
          description: Product created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Product"
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

    get:
      tags: [Owner]
      summary: List products (Owner view)
      description: >
        Returns a paginated list of products with filtering and sorting. OWNER only.
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: q
          schema: { type: string }
          description: Search query (partial match on title)
        - in: query
          name: category
          schema:
            type: string
            enum: [RUDRAKSHA, GEMSTONE, ACCESSORY]
          description: Filter by product category
        - in: query
          name: active
          schema: { type: boolean }
          description: Filter by active status
        - in: query
          name: min_price_paise
          schema: { type: integer, minimum: 0 }
          description: Minimum price (paise)
        - in: query
          name: max_price_paise
          schema: { type: integer, minimum: 0 }
          description: Maximum price (paise)
        - in: query
          name: in_stock
          schema: { type: boolean }
          description: Only products that have stock_qty > 0
        - in: query
          name: has_images
          schema: { type: boolean }
          description: Only products that have at least one image
        - in: query
          name: created_from
          schema: { type: string, format: date-time }
          description: Filter products created after this timestamp
        - in: query
          name: created_to
          schema: { type: string, format: date-time }
          description: Filter products created before this timestamp
        - in: query
          name: page
          schema: { type: integer, default: 1, minimum: 1 }
          description: Page number (1-based)
        - in: query
          name: pageSize
          schema: { type: integer, default: 20, maximum: 100 }
          description: Number of items per page
        - in: query
          name: sort
          schema:
            type: string
            enum: [created_at, -created_at, price_paise, -price_paise, title, -title]
            default: -created_at
          description: Sort order
        - in: query
          name: include
          schema:
            type: string
            enum: [none, primary, images]
            default: none
          description: >
            Controls image expansion in list results.
            - none: no images (fastest)
            - primary: includes `primary_image_url`
            - images: includes `images` array (limited by images_limit)
        - in: query
          name: images_limit
          schema: { type: integer, default: 5, maximum: 10 }
          description: Max images per product when include=images
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductListResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

  /api/v1/owner/products/{id}:
    get:
      tags: [Owner]
      summary: Get product detail
      description: >
        Fetch a single product with all its details, including images and variants.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductDetail"
        "404":
          description: Product not found

    put:
      tags: [Owner]
      summary: Update product
      description: >
        Updates product details by ID. Fields not provided are left unchanged.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OwnerUpdateProductRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Product"
        "404":
          description: Product not found

    delete:
      tags: [Owner]
      summary: Soft delete product
      description: >
        Marks the product as deleted (soft delete) and sets active = false.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        "204":
          description: Product deleted
        "404":
          description: Not found

  /api/v1/owner/products/{id}/images:
    post:
      tags: [Owner]
      summary: Upload product image
      description: >
        Upload an image for a product (multipart/form-data field: `image`). Stored in Azure Blob.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [image]
              properties:
                image:
                  type: string
                  format: binary
      responses:
        "201":
          description: Image uploaded
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductImage"
        "400":
          description: Invalid image or validation error
        "404":
          description: Product not found

  /api/v1/owner/products/{id}/images/order:
    put:
      tags: [Owner]
      summary: Reorder product images
      description: >
        Updates the display order of product images.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/ImageOrderItem"
      responses:
        "204":
          description: Reordered
        "404":
          description: Product or image not found

  /api/v1/owner/products/{id}/images/{imageId}:
    delete:
      tags: [Owner]
      summary: Delete product image
      description: >
        Deletes a product image and removes it from Azure Blob Storage.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
        - in: path
          name: imageId
          required: true
          schema: { type: string, format: uuid }
      responses:
        "204":
          description: Image deleted
        "404":
          description: Image not found

  /api/v1/owner/products/{id}/variants:
    post:
      tags: [Owner]
      summary: Create product variant
      description: >
        Adds a new variant (e.g., bead size) for a product.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/VariantCreateRequest"
      responses:
        "201":
          description: Variant created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductVariant"
        "404":
          description: Product not found

  /api/v1/owner/products/{id}/variants/{variantId}:
    put:
      tags: [Owner]
      summary: Update product variant
      description: >
        Updates variant details such as price, label, or SKU.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
        - in: path
          name: variantId
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/VariantUpdateRequest"
      responses:
        "200":
          description: Variant updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductVariant"
        "404":
          description: Variant not found

    delete:
      tags: [Owner]
      summary: Delete product variant
      description: >
        Permanently deletes a product variant from the database.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
        - in: path
          name: variantId
          required: true
          schema: { type: string, format: uuid }
      responses:
        "204":
          description: Variant deleted
        "404":
          description: Variant not found
